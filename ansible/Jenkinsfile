#!/groovy

node {
    def work_dir = '$JENKINS_HOME/project7'

    stage('Git Checkout') {
        checkout (
            [
            $class: 'GitSCM',
            userRemoteConfigs: [[url: "${CJK_GIT_URL}",credentialsId: "${CREDENTIALS_ID}" ]],
            branches: [[name: "${BRANCH_NAME}"]]
            ]
        )

    }
    stage('Install Ansible') {
        sh ('''
            sudo amazon-linux-extras install ansible2
            ansible --version
            #!/bin/bash
            if [ ! -d $JENKINS_HOME/project7]
            then
                echo $PWD
                mkdir -p project7
            fi
        ''')
    }
    stage('Execute Playbook') {
        try {
            ansiblePlaybook(
                playbook: 'ansible/site.yml',
                become: 'true',
                credentialsId: 'Ansible_cred',
                inventory: 'ansible/hosts-dev'
            )
        }
        catch(e){
            println(e)
        }
        finally {
            echo 'Completed'
        }
    }
}
